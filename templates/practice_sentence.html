{% extends "base.html" %}

{% block content %}
<div class="row justify-content-center">
    <div class="col-md-8">
        <div class="card shadow-sm">
            <div class="card-body">
                <h3 class="card-title mb-3">C√ºmle & Grammar - LoroLeng</h3>
                <p class="text-muted">Kullanƒ±cƒ±: {{ username }}</p>

                <form method="post" class="mb-3">
                    <div class="mb-3">
                        <label class="form-label">ƒ∞ngilizce bir c√ºmle yaz:</label>
                        <textarea name="sentence" class="form-control" rows="3" required>{{ user_sentence or "" }}</textarea>
                    </div>
                    <button type="submit" class="btn btn-success">Analiz Et</button>
                    <a href="{{ url_for('dashboard') }}" class="btn btn-link">Geri d√∂n</a>
                </form>

                {% if feedback %}
                    <!-- Skor g√∂stergesi -->
                    <div class="alert {% if feedback.is_valid %}alert-success{% else %}alert-warning{% endif %} mb-3">
                        <h5>üìä Deƒüerlendirme Sonucu</h5>
                        <div class="progress mb-2">
                            <div class="progress-bar {% if feedback.score >= 80 %}bg-success{% elif feedback.score >= 60 %}bg-warning{% else %}bg-danger{% endif %}" 
                                 style="width: {{ feedback.score }}%">
                                {{ feedback.score }}/100
                            </div>
                        </div>
                        {% if feedback.is_valid %}
                            <p class="mb-0">‚úÖ <strong>Harika!</strong> C√ºmleniz grammer a√ßƒ±sƒ±ndan doƒüru!</p>
                        {% else %}
                            <p class="mb-0">‚ö†Ô∏è <strong>Dikkat:</strong> C√ºmlenizde bazƒ± hatalar var. A≈üaƒüƒ±daki √∂nerileri inceleyin.</p>
                        {% endif %}
                    </div>

                    <!-- Hata listesi -->
                    {% if feedback.errors %}
                        <div class="alert alert-danger">
                            <h6>‚ùå Tespit Edilen Hatalar:</h6>
                            <ul class="mb-0">
                                {% for error in feedback.errors %}
                                    <li>
                                        <strong>[{{ error.rule }}]</strong> {{ error.message_tr }}
                                        {% if error.example_correction %}
                                            <br><small class="text-muted">√ñrnek: <em>{{ error.example_correction }}</em></small>
                                        {% endif %}
                                    </li>
                                {% endfor %}
                            </ul>
                        </div>
                    {% endif %}

                    <!-- √ñneriler -->
                    {% if feedback.suggestions %}
                        <div class="alert alert-info">
                            <h6>üí° √ñneriler:</h6>
                            <ul class="mb-0">
                                {% for suggestion in feedback.suggestions %}
                                    <li>{{ suggestion }}</li>
                                {% endfor %}
                            </ul>
                        </div>
                    {% endif %}
                {% endif %}
            </div>
        </div>
    </div>
</div>
{% endblock %}
